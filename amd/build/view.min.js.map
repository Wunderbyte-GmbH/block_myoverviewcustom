{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the overview block.\n *\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport * as Repository from 'block_myoverviewcustom/repository';\nimport * as PagedContentFactory from 'core/paged_content_factory';\nimport * as PubSub from 'core/pubsub';\nimport * as CustomEvents from 'core/custom_interaction_events';\nimport * as Notification from 'core/notification';\nimport * as Templates from 'core/templates';\nimport * as CourseEvents from 'core_course/events';\nimport SELECTORS from 'block_myoverviewcustom/selectors';\nimport * as PagedContentEvents from 'core/paged_content_events';\nimport * as Aria from 'core/aria';\nimport {debounce} from 'core/utils';\nimport {setUserPreference} from 'core_user/repository';\nimport * as Str from 'core/str';\n\nconst TEMPLATES = {\n    COURSES_CATEGORIES: 'block_myoverviewcustom/view-categories',\n    COURSES_CARDS: 'block_myoverviewcustom/view-cards',\n    NOCOURSES: 'core_course/no-courses'\n};\n\nconst GROUPINGS = {\n    GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n    GROUPING_ALL: 'all',\n    GROUPING_INPROGRESS: 'inprogress',\n    GROUPING_FUTURE: 'future',\n    GROUPING_PAST: 'past',\n    GROUPING_FAVOURITES: 'favourites',\n    GROUPING_HIDDEN: 'hidden'\n};\n\nconst NUMCOURSES_PERPAGE = [0];\n\nlet loadedPages = [];\n\nlet courseOffset = 0;\n\nlet lastPage = 0;\n\nlet lastLimit = 0;\n\nlet namespace = null;\n\n/**\n * Whether the summary display has been loaded.\n *\n * If true, this means that courses have been loaded with the summary text.\n * Otherwise, switching to the summary display mode will require course data to be fetched with the summary text.\n *\n * @type {boolean}\n */\nlet summaryDisplayLoaded = false;\n\n/**\n * Get filter values from DOM.\n *\n * @param {object} root The root element for the courses view.\n * @return {filters} Set filters.\n */\nconst getFilterValues = root => {\n    const courseRegion = root.find(SELECTORS.courseView.region);\n    return {\n        display: courseRegion.attr('data-display'),\n        grouping: courseRegion.attr('data-grouping'),\n        sort: courseRegion.attr('data-sort'),\n        displaycategories: courseRegion.attr('data-displaycategories'),\n        customfieldname: courseRegion.attr('data-customfieldname'),\n        customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n    };\n};\n\n// We want the paged content controls below the paged content area.\n// and the controls should be ignored while data is loading.\nconst DEFAULT_PAGED_CONTENT_CONFIG = {\n    ignoreControlWhileLoading: true,\n    controlPlacementBottom: true,\n    persistentLimitKey: 'block_myoverviewcustom_user_paging_preference'\n};\n\n/**\n * Get enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @return {promise} Resolved with an array of courses.\n */\nconst getMyCourses = (filters, limit) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: filters.grouping,\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n    };\n    return Repository.getEnrolledCoursesWithCustomfields(params);\n};\n\n/**\n * Search for enrolled courses from backend.\n *\n * @param {object} filters The filters for this view.\n * @param {int} limit The number of courses to show.\n * @param {string} searchValue What does the user want to search within their courses.\n * @return {promise} Resolved with an array of courses.\n */\nconst getSearchMyCourses = (filters, limit, searchValue) => {\n    const params = {\n        offset: courseOffset,\n        limit: limit,\n        classification: 'search',\n        sort: filters.sort,\n        customfieldname: filters.customfieldname,\n        customfieldvalue: filters.customfieldvalue,\n        searchvalue: searchValue,\n    };\n    return Repository.getEnrolledCoursesByTimeline(params);\n};\n\n/**\n * Get the container element for the favourite icon.\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n * @return {Object} The favourite icon container\n */\nconst getFavouriteIconContainer = (root, courseId) => {\n    return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the paged content container element.\n *\n * @param {Object} root The course overview container\n * @param {Number} index Rendered page index.\n * @return {Object} The rendered paged container.\n */\nconst getPagedContentContainer = (root, index) => {\n    return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n};\n\n/**\n * Get the course id from a favourite element.\n *\n * @param {Object} root The favourite icon container element.\n * @return {Number} Course id.\n */\nconst getCourseId = root => {\n    return root.attr('data-course-id');\n};\n\n/**\n * Hide the favourite icon.\n *\n * @param {Object} root The favourite icon container element.\n * @param {Number} courseId Course id number.\n */\nconst hideFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.addClass('hidden');\n    Aria.hide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.removeClass('hidden');\n    Aria.unhide(notFavourteIcon);\n};\n\n/**\n * Show the favourite icon.\n *\n * @param {Object} root The course overview container.\n * @param {Number} courseId Course id number.\n */\nconst showFavouriteIcon = (root, courseId) => {\n    const iconContainer = getFavouriteIconContainer(root, courseId);\n\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n    isFavouriteIcon.removeClass('hidden');\n    Aria.unhide(isFavouriteIcon);\n\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n    notFavourteIcon.addClass('hidden');\n    Aria.hide(notFavourteIcon);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The add to favourite menu item.\n */\nconst getAddFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The remove from favourites menu item.\n */\nconst getRemoveFavouriteMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Add course to favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst addToFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, true).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.favourited, courseId);\n            removeAction.removeClass('hidden');\n            addAction.addClass('hidden');\n            showFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Remove course from favourites\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst removeFromFavourites = (root, courseId) => {\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\n    const addAction = getAddFavouriteMenuItem(root, courseId);\n\n    setCourseFavouriteState(courseId, false).then(success => {\n        if (success) {\n            PubSub.publish(CourseEvents.unfavorited, courseId);\n            removeAction.addClass('hidden');\n            addAction.removeClass('hidden');\n            hideFavouriteIcon(root, courseId);\n        } else {\n            Notification.alert('Starring course failed', 'Could not change favourite state');\n        }\n        return;\n    }).catch(Notification.exception);\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The hide course menu item.\n */\nconst getHideCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Get the action menu item\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id.\n * @return {Object} The show course menu item.\n */\nconst getShowCourseMenuItem = (root, courseId) => {\n    return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n};\n\n/**\n * Hide course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst hideCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, true);\n\n    // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.addClass('hidden');\n    showAction.removeClass('hidden');\n};\n\n/**\n * Show course\n *\n * @param {Object} root The course overview container\n * @param {Number} courseId Course id number\n */\nconst showCourse = (root, courseId) => {\n    const hideAction = getHideCourseMenuItem(root, courseId);\n    const showAction = getShowCourseMenuItem(root, courseId);\n    const filters = getFilterValues(root);\n\n    setCourseHiddenState(courseId, null);\n\n    // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n        hideElement(root, courseId);\n    }\n\n    hideAction.removeClass('hidden');\n    showAction.addClass('hidden');\n};\n\n/**\n * Set the courses hidden status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {Boolean} status new hidden status.\n * @return {Promise} Repository promise.\n */\nconst setCourseHiddenState = (courseId, status) => {\n\n    // If the given status is not hidden, the preference has to be deleted with a null value.\n    if (status === false) {\n        status = null;\n    }\n\n    return setUserPreference(`block_myoverviewcustom_hidden_course_${courseId}`, status)\n        .catch(Notification.exception);\n};\n\n/**\n * Reset the loadedPages dataset to take into account the hidden element\n *\n * @param {Object} root The course overview container\n * @param {Number} id The course id number\n */\nconst hideElement = (root, id) => {\n    const pagingBar = root.find('[data-region=\"paging-bar\"]');\n    const jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n    // Get a reduced dataset for the current page.\n    const courseList = loadedPages[jumpto];\n    let reducedCourse = courseList.courses.reduce((accumulator, current) => {\n        if (+id !== +current.id) {\n            accumulator.push(current);\n        }\n        return accumulator;\n    }, []);\n\n    // Get the next page's data if loaded and pop the first element from it.\n    if (typeof (loadedPages[jumpto + 1]) !== 'undefined') {\n        const newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n        // Adjust the dataset for the reset of the pages that are loaded.\n        loadedPages.forEach((courseList, index) => {\n            if (index > jumpto) {\n                let popElement = [];\n                if (typeof (loadedPages[index + 1]) !== 'undefined') {\n                    popElement = loadedPages[index + 1].courses.slice(0, 1);\n                }\n                loadedPages[index].courses = [...loadedPages[index].courses.slice(1), ...popElement];\n            }\n        });\n\n        reducedCourse = [...reducedCourse, ...newElement];\n    }\n\n    // Check if the next page is the last page and if it still has data associated to it.\n    if (lastPage === jumpto + 1 && loadedPages[jumpto + 1].courses.length === 0) {\n        const pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n        PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n    }\n\n    loadedPages[jumpto].courses = reducedCourse;\n\n    // Reduce the course offset.\n    courseOffset--;\n\n    // Render the paged content for the current.\n    const pagedContentPage = getPagedContentContainer(root, jumpto);\n    renderCourses(root, loadedPages[jumpto]).then((html, js) => {\n        return Templates.replaceNodeContents(pagedContentPage, html, js);\n    }).catch(Notification.exception);\n\n    // Delete subsequent pages in order to trigger the callback.\n    loadedPages.forEach((courseList, index) => {\n        if (index > jumpto) {\n            const page = getPagedContentContainer(root, index);\n            page.remove();\n        }\n    });\n};\n\n/**\n * Set the courses favourite status and push to repository\n *\n * @param {Number} courseId Course id to favourite.\n * @param {boolean} status new favourite status.\n * @return {Promise} Repository promise.\n */\nconst setCourseFavouriteState = (courseId, status) => {\n\n    return Repository.setFavouriteCourses({\n        courses: [\n            {\n                'id': courseId,\n                'favourite': status\n            }\n        ]\n    }).then(result => {\n        if (result.warnings.length === 0) {\n            loadedPages.forEach(courseList => {\n                courseList.courses.forEach((course, index) => {\n                    if (course.id == courseId) {\n                        courseList.courses[index].isfavourite = status;\n                    }\n                });\n            });\n            return true;\n        } else {\n            return false;\n        }\n    }).catch(Notification.exception);\n};\n\n/**\n * Given there are no courses to render provide the rendered template.\n *\n * @param {object} root The root element for the courses view.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst noCoursesRender = root => {\n    const nocoursesimg = root.find(SELECTORS.courseView.region).attr('data-nocoursesimg');\n    const newcourseurl = root.find(SELECTORS.courseView.region).attr('data-newcourseurl');\n    return Templates.render(TEMPLATES.NOCOURSES, {\n        nocoursesimg: nocoursesimg,\n        newcourseurl: newcourseurl\n    });\n};\n\n/**\n * Render the dashboard courses.\n *\n * @param {object} root The root element for the courses view.\n * @param {array} coursesData containing array of returned courses.\n * @return {promise} jQuery promise resolved after rendering is complete.\n */\nconst renderCourses = (root, coursesData) => {\n    if (!coursesData || !coursesData.courses || !coursesData.courses.length) {\n        return noCoursesRender(root);\n    }\n    return renderCategoriesOnly(root, coursesData);\n};\nconst renderCourses2 = (root, coursesData) => {\n\n    const filters = getFilterValues(root);\n\n    let currentTemplate = '';\n    currentTemplate = TEMPLATES.COURSES_CARDS;\n\n    if (!coursesData) {\n        return noCoursesRender(root);\n    } else {\n        // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\n        if (Array.isArray(coursesData.courses) === false) {\n            coursesData.courses = Object.values(coursesData.courses);\n        }\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(course => {\n            course.showcoursecategory = filters.displaycategories === 'on';\n            return course;\n        });\n        const groupedCourses = Object.entries(coursesData.courses.reduce((acc, course) => {\n            const category = course.customfieldvalue || Str.get_strings('uncategorized', 'block_myoverviewcustom');\n            if (!acc[category]) {\n                acc[category] = [];\n            }\n            acc[category].push(course);\n            return acc;\n        }, {})).map(([category, courses]) => ({\n            category,\n            courses\n        })).sort((a, b) => a.category.localeCompare(b.category, undefined, { sensitivity: 'base' }));\n\n        const allcategories = Array.from(new Set(\n            coursesData.courses.map(course => course.customfieldvalue || Str.get_strings('uncategorized', 'block_myoverviewcustom'))\n        )).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }));\n\n        if (Object.keys(groupedCourses).length) {\n            return Templates.render(currentTemplate, {\n                groupedCourses,\n                'allcategories': allcategories,\n            });\n        } else {\n            return noCoursesRender(root);\n        }\n    }\n};\n\n/**\n * Return the callback to be passed to the subscribe event\n *\n * @param {object} root The root element for the courses view\n * @return {function} Partially applied function that'll execute when passed a limit\n */\nconst setLimit = root => {\n    // @param {Number} limit The paged limit that is passed through the event.\n    return limit => root.find(SELECTORS.courseView.region).attr('data-paging', limit);\n};\n\n/**\n * Intialise the paged list and cards views on page load.\n * Returns an array of paged contents that we would like to handle here\n *\n * @param {object} root The root element for the courses view\n * @param {string} namespace The namespace for all the events attached\n */\nconst registerPagedEventHandlers = (root, namespace) => {\n    const event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n    PubSub.subscribe(event, setLimit(root));\n};\n\n/**\n * Figure out how many items are going to be allowed to be rendered in the block.\n *\n * @param  {Number} pagingLimit How many courses to display\n * @param  {Object} root The course overview container\n * @return {Number[]} How many courses will be rendered\n */\nconst itemsPerPageFunc = (pagingLimit, root) => {\n    let itemsPerPage = NUMCOURSES_PERPAGE.map(value => {\n        let active = false;\n        if (value === pagingLimit) {\n            active = true;\n        }\n\n        return {\n            value: value,\n            active: active\n        };\n    });\n\n    // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n    const totalCourseCount = parseInt(root.find(SELECTORS.courseView.region).attr('data-totalcoursecount'), 10);\n    return itemsPerPage.filter(pagingOption => {\n        if (pagingOption.value === 0 && totalCourseCount > 300) {\n            // To minimise performance issues, do not show the \"All\" option if the user is enrolled in more than 100 courses.\n            return false;\n        }\n        return pagingOption.value < totalCourseCount;\n    });\n};\n\n/**\n * Mutates and controls the loadedPages array and handles the bootstrapping.\n *\n * @param {Array|Object} coursesData Array of all of the courses to start building the page from\n * @param {Number} currentPage What page are we currently on?\n * @param {Object} pageData Any current page information\n * @param {Object} actions Paged content helper\n * @param {null|boolean} activeSearch Are we currently actively searching and building up search results?\n */\nconst pageBuilder = (coursesData, currentPage, pageData, actions, activeSearch = null) => {\n    // If the courseData comes in an object then get the value otherwise it is a pure array.\n    let courses = coursesData.courses ? coursesData.courses : coursesData;\n    let nextPageStart = 0;\n    let pageCourses = [];\n\n    // If current page's data is loaded make sure we max it to page limit.\n    if (typeof (loadedPages[currentPage]) !== 'undefined') {\n        pageCourses = loadedPages[currentPage].courses;\n        const currentPageLength = pageCourses.length;\n        if (currentPageLength < pageData.limit) {\n            nextPageStart = pageData.limit - currentPageLength;\n            pageCourses = {...loadedPages[currentPage].courses, ...courses.slice(0, nextPageStart)};\n        }\n    } else {\n        // When the page limit is zero, there is only one page of courses, no start for next page.\n        nextPageStart = pageData.limit || false;\n        pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n    }\n\n    // Finished setting up the current page.\n    loadedPages[currentPage] = {\n        courses: pageCourses\n    };\n\n    // Set up the next page (if there is more than one page).\n    const remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n    if (remainingCourses.length) {\n        loadedPages[currentPage + 1] = {\n            courses: remainingCourses\n        };\n    }\n\n    // Set the last page to either the current or next page.\n    if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n        lastPage = currentPage;\n        if (activeSearch === null) {\n            actions.allItemsLoaded(currentPage);\n        }\n    } else if (typeof (loadedPages[currentPage + 1]) !== 'undefined'\n        && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n        lastPage = currentPage + 1;\n    }\n\n    courseOffset = coursesData.nextoffset;\n};\n\n/**\n * In cases when switching between regular rendering and search rendering we need to reset some variables.\n */\nconst resetGlobals = () => {\n    courseOffset = 0;\n    loadedPages = [];\n    lastPage = 0;\n    lastLimit = 0;\n};\n\n/**\n * The default functionality of fetching paginated courses without special handling.\n *\n * @return {function(Object, Object, Object, Object, Object, Promise, Number): void}\n */\nconst standardFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit) => {\n        const pagePromise = getMyCourses(\n            filters,\n            limit\n        ).then(coursesData => {\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(pagePromise);\n    };\n};\n\n/**\n * Initialize the searching functionality so we can call it when required.\n *\n * @return {function(Object, Number, Object, Object, Object, Promise, Number, String): void}\n */\nconst searchFunctionalityCurry = () => {\n    resetGlobals();\n    return (filters, currentPage, pageData, actions, root, promises, limit, inputValue) => {\n        const searchingPromise = getSearchMyCourses(\n            filters,\n            limit,\n            inputValue\n        ).then(coursesData => {\n            pageBuilder(coursesData, currentPage, pageData, actions);\n            return renderCourses(root, loadedPages[currentPage]);\n        }).catch(Notification.exception);\n\n        promises.push(searchingPromise);\n    };\n};\n\n\nconst attachSearchListeners = (root) => {\n    return;\n    const input = document.querySelector(SELECTORS.region.searchInput);\n    const clearIcon = document.querySelector(SELECTORS.region.clearIcon);\n\n    if (!input || !clearIcon) {\n        return;\n    }\n    // Remove previous listeners before adding new ones\n    const newInput = input.cloneNode(true);\n    input.parentNode.replaceChild(newInput, input);\n\n    const newClearIcon = clearIcon.cloneNode(true);\n    clearIcon.parentNode.replaceChild(newClearIcon, clearIcon);\n    newClearIcon.addEventListener('click', () => {\n        newInput.value = '';\n        newInput.focus();\n        clearSearch(newClearIcon, root);\n    });\n\n    newInput.addEventListener('input', debounce(() => {\n        if (newInput.value === '') {\n            clearSearch(newClearIcon, root);\n        } else {\n            activeSearch(newClearIcon);\n            initializePagedContent(root, searchFunctionalityCurry(), newInput.value.trim());\n        }\n    }, 1000));\n};\n\n/**\n * Initialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n * @param {function} promiseFunction How do we fetch the courses and what do we do with them?\n * @param {null | string} inputValue What to search for\n */\nconst initializePagedContent = (root, promiseFunction, inputValue = null) => {\n    const pagingLimit = parseInt(root.find(SELECTORS.courseView.region).attr('data-paging'), 10);\n    let itemsPerPage = itemsPerPageFunc(pagingLimit, root);\n\n    const config = {...{}, ...DEFAULT_PAGED_CONTENT_CONFIG};\n    config.eventNamespace = namespace;\n\n    const pagedContentPromise = PagedContentFactory.createWithLimit(\n        itemsPerPage,\n        (pagesData, actions) => {\n            let promises = [];\n            pagesData.forEach(pageData => {\n                const currentPage = pageData.pageNumber;\n                let limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                // Reset local variables if limits have changed.\n                if (+lastLimit !== +limit) {\n                    loadedPages = [];\n                    courseOffset = 0;\n                    lastPage = 0;\n                }\n\n                if (lastPage === currentPage) {\n                    // If we are on the last page and have it's data then load it from cache.\n                    actions.allItemsLoaded(lastPage);\n                    promises.push(renderCourses(root, loadedPages[currentPage]));\n                    return;\n                }\n\n                lastLimit = limit;\n\n                // Get 2 pages worth of data as we will need it for the hidden functionality.\n                if (typeof (loadedPages[currentPage + 1]) === 'undefined') {\n                    if (typeof (loadedPages[currentPage]) === 'undefined') {\n                        limit *= 2;\n                    }\n                }\n\n                // Get the current applied filters.\n                const filters = getFilterValues(root);\n\n                // Call the curried function that'll handle the course promise and any manipulation of it.\n                promiseFunction(filters, currentPage, pageData, actions, root, promises, limit, inputValue);\n            });\n            return promises;\n        },\n        config\n    );\n\n    pagedContentPromise.then((html, js) => {\n        registerPagedEventHandlers(root, namespace);\n        return Templates.replaceNodeContents(root.find(SELECTORS.courseView.region), html, js);\n    }).catch(Notification.exception);\n};\n\n/**\n * Listen to, and handle events for the myoverviewcustom block.\n *\n * @param {Object} root The myoverviewcustom block container element.\n * @param {HTMLElement} page The whole HTMLElement for our block.\n */\nconst registerEventListeners = (root, page) => {\n\n    CustomEvents.define(root, [\n        CustomEvents.events.activate\n    ]);\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        addToFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, (e, data) => {\n        const favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n        const courseId = getCourseId(favourite);\n        removeFromFavourites(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, (e, data) => {\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n        const courseId = getCourseId(target);\n        hideCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, (e, data) => {\n        const target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n        const courseId = getCourseId(target);\n        showCourse(root, courseId);\n        data.originalEvent.preventDefault();\n    });\n\n    root.on('change', '.category-filter', () => {\n        const selectedCategories = root.find('.category-filter:checked').map(function () {\n            return $(this).val();\n        }).get();\n        root.find('.category-group').each(function () {\n            const categoryHeading = $(this).find('.category-heading').text().trim();\n            const visible = selectedCategories.length === 0 || selectedCategories.includes(categoryHeading);\n            $(this).toggle(visible);\n        });\n    });\n\n    // // Searching functionality event handlers.\n    // const input = page.querySelector(SELECTORS.region.searchInput);\n    // const clearIcon = page.querySelector(SELECTORS.region.clearIcon);\n\n    // clearIcon.addEventListener('click', () => {\n    //     input.value = '';\n    //     input.focus();\n    //     clearSearch(clearIcon, root);\n    // });\n\n    // input.addEventListener('input', debounce(() => {\n    //     if (input.value === '') {\n    //         clearSearch(clearIcon, root);\n    //     } else {\n    //         activeSearch(clearIcon);\n    //         initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n    //     }\n    // }, 1000));\n};\n\n/**\n * Render only the list of categories.\n *\n * @param {object} root The root element.\n * @param {object} coursesData The courses data object.\n * @return {Promise}\n */\nconst renderCategoriesOnly = async (root, coursesData) => {\n    if (!Array.isArray(coursesData.courses)) {\n        coursesData.courses = Object.values(coursesData.courses);\n    }\n\n    const container = root.find('[data-region=\"courseview\"]');\n\n    try {\n        const uncategorizedStr = await Str.get_string('uncategorized', 'block_myoverviewcustom');\n\n        const allCategories = Array.from(new Set(\n            coursesData.courses.map(course => course.customfieldvalue || uncategorizedStr)\n        )).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: 'base' }));\n\n        const html = await Templates.render(TEMPLATES.COURSES_CATEGORIES, {\n            categories: allCategories\n        });\n\n        container.html(html);\n\n        root.find('.category-link').on('click', function () {\n            const selectedCategory = $(this).data('category');\n            renderCoursesByCategory(root, coursesData, selectedCategory);\n        });\n\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\n/**\n * Render courses belonging to a specific category.\n *\n * @param {object} root The root element.\n * @param {object} coursesData The courses data.\n * @param {string} selectedCategory The selected category.\n * @return {Promise}\n */\nconst renderCoursesByCategory = async (root, coursesData, selectedCategory) => {\n    const filters = getFilterValues(root);\n    const container = root.find('[data-region=\"courseview\"]');\n\n    const template = TEMPLATES.COURSES_CARDS;\n\n    try {\n        const uncategorizedStr = await Str.get_string('uncategorized', 'block_myoverviewcustom');\n\n        const filteredCourses = coursesData.courses\n            .filter(course => (course.customfieldvalue || uncategorizedStr) === selectedCategory)\n            .map(course => {\n                course.showcoursecategory = filters.displaycategories === 'on';\n                return course;\n            });\n\n        const html = await Templates.render(template, {\n            groupedCourses: [{ category: selectedCategory, courses: filteredCourses }],\n            allcategories: [selectedCategory],\n            backToCategories: true\n        });\n\n        container.html(html);\n        container.find('.back-to-categories').on('click', () => {\n            renderCategoriesOnly(root, coursesData);\n        });\n        attachSearchListeners(root);\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\n/**\n * Reset the search icon and trigger the init for the block.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n * @param {Object} root The myoverviewcustom block container element.\n */\nexport const clearSearch = (clearIcon, root) => {\n    clearIcon.classList.add('d-none');\n    init(root);\n};\n\n/**\n * Change the searching icon to its' active state.\n *\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\n */\nconst activeSearch = (clearIcon) => {\n    clearIcon.classList.remove('d-none');\n};\n\n/**\n * Intialise the courses list and cards views on page load.\n *\n * @param {object} root The root element for the courses view.\n */\nexport const init = root => {\n    root = $(root);\n    loadedPages = [];\n    lastPage = 0;\n    courseOffset = 0;\n\n    if (!root.attr('data-init')) {\n        const page = document.querySelector(SELECTORS.region.selectBlock);\n        registerEventListeners(root, page);\n        namespace = \"block_myoverviewcustom_\" + root.attr('id') + \"_\" + Math.random();\n        root.attr('data-init', true);\n    }\n\n    initializePagedContent(root, standardFunctionalityCurry());\n};\n\n/**\n * Reset the courses views to their original\n * state on first page load.courseOffset\n *\n * This is called when configuration has changed for the event lists\n * to cause them to reload their data.\n *\n * @param {Object} root The root element for the timeline view.\n */\nexport const reset = root => {\n    if (loadedPages.length > 0) {\n        const filters = getFilterValues(root);\n        // If the display mode is changed to 'summary' but the summary display has not been loaded yet,\n        // we need to re-fetch the courses to include the course summary text.\n        if (filters.display === 'summary' && !summaryDisplayLoaded) {\n            const page = document.querySelector(SELECTORS.region.selectBlock);\n            const input = page.querySelector(SELECTORS.region.searchInput);\n            if (input.value !== '') {\n                initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\n            } else {\n                initializePagedContent(root, standardFunctionalityCurry());\n            }\n        } else {\n            loadedPages.forEach((courseList, index) => {\n                let pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then((html, js) => {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        }\n    } else {\n        init(root);\n    }\n};\n"],"names":["TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","getFilterValues","root","courseRegion","find","SELECTORS","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getFavouriteIconContainer","courseId","FAVOURITE_ICON","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","PubSub","publish","CourseEvents","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","ICON_IS_FAVOURITE","Aria","unhide","notFavourteIcon","ICON_NOT_FAVOURITE","hide","showFavouriteIcon","Notification","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","courseList","popElement","length","pagedContentContainer","PagedContentFactory","resetLastPageNumber","pagedContentPage","renderCourses","html","js","Templates","replaceNodeContents","remove","Repository","setFavouriteCourses","result","warnings","course","isfavourite","noCoursesRender","nocoursesimg","newcourseurl","render","coursesData","renderCategoriesOnly","registerPagedEventHandlers","event","PagedContentEvents","SET_ITEMS_PER_PAGE_LIMIT","subscribe","limit","setLimit","itemsPerPageFunc","pagingLimit","itemsPerPage","map","value","active","totalCourseCount","filter","pagingOption","pageBuilder","currentPage","pageData","actions","activeSearch","nextPageStart","pageCourses","currentPageLength","remainingCourses","allItemsLoaded","nextoffset","resetGlobals","standardFunctionalityCurry","filters","promises","pagePromise","params","offset","classification","getEnrolledCoursesWithCustomfields","getMyCourses","searchFunctionalityCurry","inputValue","searchingPromise","searchValue","searchvalue","getEnrolledCoursesByTimeline","getSearchMyCourses","initializePagedContent","promiseFunction","config","eventNamespace","pagedContentPromise","createWithLimit","pagesData","pageNumber","registerEventListeners","page","CustomEvents","define","events","activate","on","ACTION_ADD_FAVOURITE","e","data","favourite","target","closest","originalEvent","preventDefault","ACTION_REMOVE_FAVOURITE","ACTION_HIDE_COURSE","hideAction","showAction","hideCourse","ACTION_SHOW_COURSE","showCourse","selectedCategories","this","val","get","each","categoryHeading","text","trim","visible","includes","toggle","async","Array","isArray","Object","values","container","uncategorizedStr","Str","get_string","allCategories","from","Set","a","b","localeCompare","undefined","sensitivity","categories","selectedCategory","renderCoursesByCategory","error","template","filteredCourses","showcoursecategory","groupedCourses","category","allcategories","backToCategories","clearSearch","clearIcon","classList","add","init","document","querySelector","selectBlock","Math","random","input","searchInput"],"mappings":";;;;;;krBAqCMA,6BACkB,yCADlBA,wBAEa,oCAFbA,oBAGS,yBAGTC,sCAC2B,qBAS3BC,mBAAqB,CAAC,OAExBC,YAAc,GAEdC,aAAe,EAEfC,SAAW,EAEXC,UAAY,EAEZC,UAAY,WAkBVC,gBAAkBC,aACdC,aAAeD,KAAKE,KAAKC,mBAAUC,WAAWC,cAC7C,CACHC,QAASL,aAAaM,KAAK,gBAC3BC,SAAUP,aAAaM,KAAK,iBAC5BE,KAAMR,aAAaM,KAAK,aACxBG,kBAAmBT,aAAaM,KAAK,0BACrCI,gBAAiBV,aAAaM,KAAK,wBACnCK,iBAAkBX,aAAaM,KAAK,2BAMtCM,6BAA+B,CACjCC,2BAA2B,EAC3BC,wBAAwB,EACxBC,mBAAoB,iDAkDlBC,0BAA4B,CAACjB,KAAMkB,WAC9BlB,KAAKE,KAAKC,mBAAUgB,eAAiB,oBAAsBD,SAAW,MAU3EE,yBAA2B,CAACpB,KAAMqB,QAC7BrB,KAAKE,KAAK,iDAAmDmB,MAAQ,MAS1EC,YAActB,MACTA,KAAKO,KAAK,kBA8CfgB,wBAA0B,CAACvB,KAAMkB,WAC5BlB,KAAKE,KAAK,iDAAmDgB,SAAW,MAU7EM,2BAA6B,CAACxB,KAAMkB,WAC/BlB,KAAKE,KAAK,oDAAsDgB,SAAW,MAShFO,gBAAkB,CAACzB,KAAMkB,kBACrBQ,aAAeF,2BAA2BxB,KAAMkB,UAChDS,UAAYJ,wBAAwBvB,KAAMkB,UAEhDU,wBAAwBV,UAAU,GAAMW,MAAKC,UACrCA,SACAC,OAAOC,QAAQC,aAAaC,WAAYhB,UACxCQ,aAAaS,YAAY,UACzBR,UAAUS,SAAS,UAhDL,EAACpC,KAAMkB,kBACvBmB,cAAgBpB,0BAA0BjB,KAAMkB,UAEhDoB,gBAAkBD,cAAcnC,KAAKC,mBAAUoC,mBACrDD,gBAAgBH,YAAY,UAC5BK,KAAKC,OAAOH,uBAENI,gBAAkBL,cAAcnC,KAAKC,mBAAUwC,oBACrDD,gBAAgBN,SAAS,UACzBI,KAAKI,KAAKF,kBAwCFG,CAAkB7C,KAAMkB,WAExB4B,aAAaC,MAAM,yBAA0B,uCAGlDC,MAAMF,aAAaG,YASpBC,qBAAuB,CAAClD,KAAMkB,kBAC1BQ,aAAeF,2BAA2BxB,KAAMkB,UAChDS,UAAYJ,wBAAwBvB,KAAMkB,UAEhDU,wBAAwBV,UAAU,GAAOW,MAAKC,UACtCA,SACAC,OAAOC,QAAQC,aAAakB,YAAajC,UACzCQ,aAAaU,SAAS,UACtBT,UAAUQ,YAAY,UAzFR,EAACnC,KAAMkB,kBACvBmB,cAAgBpB,0BAA0BjB,KAAMkB,UAEhDoB,gBAAkBD,cAAcnC,KAAKC,mBAAUoC,mBACrDD,gBAAgBF,SAAS,UACzBI,KAAKI,KAAKN,uBAEJI,gBAAkBL,cAAcnC,KAAKC,mBAAUwC,oBACrDD,gBAAgBP,YAAY,UAC5BK,KAAKC,OAAOC,kBAiFJU,CAAkBpD,KAAMkB,WAExB4B,aAAaC,MAAM,yBAA0B,uCAGlDC,MAAMF,aAAaG,YAUpBI,sBAAwB,CAACrD,KAAMkB,WAC1BlB,KAAKE,KAAK,+CAAiDgB,SAAW,MAU3EoC,sBAAwB,CAACtD,KAAMkB,WAC1BlB,KAAKE,KAAK,+CAAiDgB,SAAW,MAwD3EqC,qBAAuB,CAACrC,SAAUsC,WAGrB,IAAXA,SACAA,OAAS,OAGN,kCAAmB,wCAAuCtC,WAAYsC,QACxER,MAAMF,aAAaG,YAStBQ,YAAc,CAACzD,KAAM0D,YACjBC,UAAY3D,KAAKE,KAAK,8BACtB0D,OAASC,SAASF,UAAUpD,KAAK,gCAInCuD,cADepE,YAAYkE,QACAG,QAAQC,QAAO,CAACC,YAAaC,YACnDR,KAAQQ,QAAQR,IACjBO,YAAYE,KAAKD,SAEdD,cACR,YAGsC,IAA7BvE,YAAYkE,OAAS,GAAqB,OAC5CQ,WAAa1E,YAAYkE,OAAS,GAAGG,QAAQM,MAAM,EAAG,GAG5D3E,YAAY4E,SAAQ,CAACC,WAAYlD,YACzBA,MAAQuC,OAAQ,KACZY,WAAa,QACuB,IAA5B9E,YAAY2B,MAAQ,KAC5BmD,WAAa9E,YAAY2B,MAAQ,GAAG0C,QAAQM,MAAM,EAAG,IAEzD3E,YAAY2B,OAAO0C,QAAU,IAAIrE,YAAY2B,OAAO0C,QAAQM,MAAM,MAAOG,gBAIjFV,cAAgB,IAAIA,iBAAkBM,eAItCxE,WAAagE,OAAS,GAAgD,IAA3ClE,YAAYkE,OAAS,GAAGG,QAAQU,OAAc,OACnEC,sBAAwB1E,KAAKE,KAAK,2CACxCyE,oBAAoBC,qBAAoB,mBAAEF,uBAAuBnE,KAAK,MAAOqD,QAGjFlE,YAAYkE,QAAQG,QAAUD,cAG9BnE,qBAGMkF,iBAAmBzD,yBAAyBpB,KAAM4D,QACxDkB,cAAc9E,KAAMN,YAAYkE,SAAS/B,MAAK,CAACkD,KAAMC,KAC1CC,UAAUC,oBAAoBL,iBAAkBE,KAAMC,MAC9DhC,MAAMF,aAAaG,WAGtBvD,YAAY4E,SAAQ,CAACC,WAAYlD,YACzBA,MAAQuC,OAAQ,CACHxC,yBAAyBpB,KAAMqB,OACvC8D,cAYXvD,wBAA0B,CAACV,SAAUsC,SAEhC4B,WAAWC,oBAAoB,CAClCtB,QAAS,CACL,IACU7C,mBACOsC,WAGtB3B,MAAKyD,QAC2B,IAA3BA,OAAOC,SAASd,SAChB/E,YAAY4E,SAAQC,aAChBA,WAAWR,QAAQO,SAAQ,CAACkB,OAAQnE,SAC5BmE,OAAO9B,IAAMxC,WACbqD,WAAWR,QAAQ1C,OAAOoE,YAAcjC,eAI7C,KAIZR,MAAMF,aAAaG,WASpByC,gBAAkB1F,aACd2F,aAAe3F,KAAKE,KAAKC,mBAAUC,WAAWC,QAAQE,KAAK,qBAC3DqF,aAAe5F,KAAKE,KAAKC,mBAAUC,WAAWC,QAAQE,KAAK,4BAC1D0E,UAAUY,OAAOtG,oBAAqB,CACzCoG,aAAcA,aACdC,aAAcA,gBAWhBd,cAAgB,CAAC9E,KAAM8F,cACpBA,aAAgBA,YAAY/B,SAAY+B,YAAY/B,QAAQU,OAG1DsB,qBAAqB/F,KAAM8F,aAFvBJ,gBAAgB1F,MAoEzBgG,2BAA6B,CAAChG,KAAMF,mBAChCmG,MAAQnG,UAAYoG,mBAAmBC,yBAC7CpE,OAAOqE,UAAUH,MAdJjG,CAAAA,MAENqG,OAASrG,KAAKE,KAAKC,mBAAUC,WAAWC,QAAQE,KAAK,cAAe8F,OAYnDC,CAAStG,QAU/BuG,iBAAmB,CAACC,YAAaxG,YAC/ByG,aAAehH,mBAAmBiH,KAAIC,YAClCC,QAAS,SACTD,QAAUH,cACVI,QAAS,GAGN,CACHD,MAAOA,MACPC,OAAQA,iBAKVC,iBAAmBhD,SAAS7D,KAAKE,KAAKC,mBAAUC,WAAWC,QAAQE,KAAK,yBAA0B,WACjGkG,aAAaK,QAAOC,gBACI,IAAvBA,aAAaJ,OAAeE,iBAAmB,MAI5CE,aAAaJ,MAAQE,oBAa9BG,YAAc,SAAClB,YAAamB,YAAaC,SAAUC,aAASC,oEAAe,KAEzErD,QAAU+B,YAAY/B,QAAU+B,YAAY/B,QAAU+B,YACtDuB,cAAgB,EAChBC,YAAc,WAGwB,IAA9B5H,YAAYuH,aAA+B,CACnDK,YAAc5H,YAAYuH,aAAalD,cACjCwD,kBAAoBD,YAAY7C,OAClC8C,kBAAoBL,SAASb,QAC7BgB,cAAgBH,SAASb,MAAQkB,kBACjCD,YAAc,IAAI5H,YAAYuH,aAAalD,WAAYA,QAAQM,MAAM,EAAGgD,sBAI5EA,cAAgBH,SAASb,QAAS,EAClCiB,YAAeJ,SAASb,MAAQ,EAAKtC,QAAQM,MAAM,EAAG6C,SAASb,OAAStC,QAI5ErE,YAAYuH,aAAe,CACvBlD,QAASuD,mBAIPE,kBAAqC,IAAlBH,cAA0BtD,QAAQM,MAAMgD,cAAetD,QAAQU,QAAU,GAC9F+C,iBAAiB/C,SACjB/E,YAAYuH,YAAc,GAAK,CAC3BlD,QAASyD,mBAKb9H,YAAYuH,aAAalD,QAAQU,OAASyC,SAASb,QAAUmB,iBAAiB/C,QAC9E7E,SAAWqH,YACU,OAAjBG,cACAD,QAAQM,eAAeR,mBAEsB,IAAlCvH,YAAYuH,YAAc,IACtCvH,YAAYuH,YAAc,GAAGlD,QAAQU,OAASyC,SAASb,QAC1DzG,SAAWqH,YAAc,GAG7BtH,aAAemG,YAAY4B,YAMzBC,aAAe,KACjBhI,aAAe,EACfD,YAAc,GACdE,SAAW,EACXC,UAAY,GAQV+H,2BAA6B,KAC/BD,eACO,CAACE,QAASZ,YAAaC,SAAUC,QAASnH,KAAM8H,SAAUzB,eACvD0B,YAxiBO,EAACF,QAASxB,eACrB2B,OAAS,CACXC,OAAQtI,aACR0G,MAAOA,MACP6B,eAAgBL,QAAQrH,SACxBC,KAAMoH,QAAQpH,KACdE,gBAAiBkH,QAAQlH,gBACzBC,iBAAkBiH,QAAQjH,yBAEvBwE,WAAW+C,mCAAmCH,SA+hB7BI,CAChBP,QACAxB,OACFxE,MAAKiE,cACHkB,YAAYlB,YAAamB,YAAaC,SAAUC,SACzCrC,cAAc9E,KAAMN,YAAYuH,iBACxCjE,MAAMF,aAAaG,WAEtB6E,SAAS3D,KAAK4D,eAShBM,yBAA2B,KAC7BV,eACO,CAACE,QAASZ,YAAaC,SAAUC,QAASnH,KAAM8H,SAAUzB,MAAOiC,oBAC9DC,iBAxiBa,EAACV,QAASxB,MAAOmC,qBAClCR,OAAS,CACXC,OAAQtI,aACR0G,MAAOA,MACP6B,eAAgB,SAChBzH,KAAMoH,QAAQpH,KACdE,gBAAiBkH,QAAQlH,gBACzBC,iBAAkBiH,QAAQjH,iBAC1B6H,YAAaD,oBAEVpD,WAAWsD,6BAA6BV,SA8hBlBW,CACrBd,QACAxB,MACAiC,YACFzG,MAAKiE,cACHkB,YAAYlB,YAAamB,YAAaC,SAAUC,SACzCrC,cAAc9E,KAAMN,YAAYuH,iBACxCjE,MAAMF,aAAaG,WAEtB6E,SAAS3D,KAAKoE,oBA0ChBK,uBAAyB,SAAC5I,KAAM6I,qBAAiBP,kEAAa,WAC1D9B,YAAc3C,SAAS7D,KAAKE,KAAKC,mBAAUC,WAAWC,QAAQE,KAAK,eAAgB,QACrFkG,aAAeF,iBAAiBC,YAAaxG,YAE3C8I,OAAS,IAAWjI,8BAC1BiI,OAAOC,eAAiBjJ,gBAElBkJ,oBAAsBrE,oBAAoBsE,gBAC5CxC,cACA,CAACyC,UAAW/B,eACJW,SAAW,UACfoB,UAAU5E,SAAQ4C,iBACRD,YAAcC,SAASiC,eACzB9C,MAASa,SAASb,MAAQ,EAAKa,SAASb,MAAQ,MAG/CxG,YAAewG,QAChB3G,YAAc,GACdC,aAAe,EACfC,SAAW,GAGXA,WAAaqH,mBAEbE,QAAQM,eAAe7H,eACvBkI,SAAS3D,KAAKW,cAAc9E,KAAMN,YAAYuH,eAIlDpH,UAAYwG,WAGkC,IAAlC3G,YAAYuH,YAAc,SACQ,IAA9BvH,YAAYuH,eACpBZ,OAAS,SAKXwB,QAAU9H,gBAAgBC,MAGhC6I,gBAAgBhB,QAASZ,YAAaC,SAAUC,QAASnH,KAAM8H,SAAUzB,MAAOiC,eAE7ER,WAEXgB,QAGJE,oBAAoBnH,MAAK,CAACkD,KAAMC,MAC5BgB,2BAA2BhG,KAAMF,WAC1BmF,UAAUC,oBAAoBlF,KAAKE,KAAKC,mBAAUC,WAAWC,QAAS0E,KAAMC,OACpFhC,MAAMF,aAAaG,YASpBmG,uBAAyB,CAACpJ,KAAMqJ,QAElCC,aAAaC,OAAOvJ,KAAM,CACtBsJ,aAAaE,OAAOC,WAGxBzJ,KAAK0J,GAAGJ,aAAaE,OAAOC,SAAUtJ,mBAAUwJ,sBAAsB,CAACC,EAAGC,cAChEC,WAAY,mBAAEF,EAAEG,QAAQC,QAAQ7J,mBAAUwJ,sBAC1CzI,SAAWI,YAAYwI,WAC7BrI,gBAAgBzB,KAAMkB,UACtB2I,KAAKI,cAAcC,oBAGvBlK,KAAK0J,GAAGJ,aAAaE,OAAOC,SAAUtJ,mBAAUgK,yBAAyB,CAACP,EAAGC,cACnEC,WAAY,mBAAEF,EAAEG,QAAQC,QAAQ7J,mBAAUgK,yBAC1CjJ,SAAWI,YAAYwI,WAC7B5G,qBAAqBlD,KAAMkB,UAC3B2I,KAAKI,cAAcC,oBAGvBlK,KAAK0J,GAAGJ,aAAaE,OAAOC,SAAUtJ,mBAAUgB,gBAAgB,CAACyI,EAAGC,QAChEA,KAAKI,cAAcC,oBAGvBlK,KAAK0J,GAAGJ,aAAaE,OAAOC,SAAUtJ,mBAAUiK,oBAAoB,CAACR,EAAGC,cAC9DE,QAAS,mBAAEH,EAAEG,QAAQC,QAAQ7J,mBAAUiK,oBACvClJ,SAAWI,YAAYyI,QAjgBlB,EAAC/J,KAAMkB,kBAChBmJ,WAAahH,sBAAsBrD,KAAMkB,UACzCoJ,WAAahH,sBAAsBtD,KAAMkB,UACzC2G,QAAU9H,gBAAgBC,MAEhCuD,qBAAqBrC,UAAU,GAI3B2G,QAAQrH,WAAahB,uCACrBiE,YAAYzD,KAAMkB,UAGtBmJ,WAAWjI,SAAS,UACpBkI,WAAWnI,YAAY,WAofnBoI,CAAWvK,KAAMkB,UACjB2I,KAAKI,cAAcC,oBAGvBlK,KAAK0J,GAAGJ,aAAaE,OAAOC,SAAUtJ,mBAAUqK,oBAAoB,CAACZ,EAAGC,cAC9DE,QAAS,mBAAEH,EAAEG,QAAQC,QAAQ7J,mBAAUqK,oBACvCtJ,SAAWI,YAAYyI,QAjflB,EAAC/J,KAAMkB,kBAChBmJ,WAAahH,sBAAsBrD,KAAMkB,UACzCoJ,WAAahH,sBAAsBtD,KAAMkB,UACzC2G,QAAU9H,gBAAgBC,MAEhCuD,qBAAqBrC,SAAU,MAI3B2G,QAAQrH,WAAahB,uCACrBiE,YAAYzD,KAAMkB,UAGtBmJ,WAAWlI,YAAY,UACvBmI,WAAWlI,SAAS,WAoehBqI,CAAWzK,KAAMkB,UACjB2I,KAAKI,cAAcC,oBAGvBlK,KAAK0J,GAAG,SAAU,oBAAoB,WAC5BgB,mBAAqB1K,KAAKE,KAAK,4BAA4BwG,KAAI,kBAC1D,mBAAEiE,MAAMC,SAChBC,MACH7K,KAAKE,KAAK,mBAAmB4K,MAAK,iBACxBC,iBAAkB,mBAAEJ,MAAMzK,KAAK,qBAAqB8K,OAAOC,OAC3DC,QAAwC,IAA9BR,mBAAmBjG,QAAgBiG,mBAAmBS,SAASJ,qCAC7EJ,MAAMS,OAAOF,gBA+BrBnF,qBAAuBsF,MAAOrL,KAAM8F,eACjCwF,MAAMC,QAAQzF,YAAY/B,WAC3B+B,YAAY/B,QAAUyH,OAAOC,OAAO3F,YAAY/B,gBAG9C2H,UAAY1L,KAAKE,KAAK,wCAGlByL,uBAAyBC,IAAIC,WAAW,gBAAiB,0BAEzDC,cAAgBR,MAAMS,KAAK,IAAIC,IACjClG,YAAY/B,QAAQ2C,KAAIlB,QAAUA,OAAO5E,kBAAoB+K,qBAC9DlL,MAAK,CAACwL,EAAGC,IAAMD,EAAEE,cAAcD,OAAGE,EAAW,CAAEC,YAAa,WAEzDtH,WAAaE,UAAUY,OAAOtG,6BAA8B,CAC9D+M,WAAYR,gBAGhBJ,UAAU3G,KAAKA,MAEf/E,KAAKE,KAAK,kBAAkBwJ,GAAG,SAAS,iBAC9B6C,kBAAmB,mBAAE5B,MAAMd,KAAK,YACtC2C,wBAAwBxM,KAAM8F,YAAayG,qBAGjD,MAAOE,OACL3J,aAAaG,UAAUwJ,SAYzBD,wBAA0BnB,MAAOrL,KAAM8F,YAAayG,0BAChD1E,QAAU9H,gBAAgBC,MAC1B0L,UAAY1L,KAAKE,KAAK,8BAEtBwM,SAAWnN,kCAGPoM,uBAAyBC,IAAIC,WAAW,gBAAiB,0BAEzDc,gBAAkB7G,YAAY/B,QAC/B+C,QAAOtB,SAAWA,OAAO5E,kBAAoB+K,oBAAsBY,mBACnE7F,KAAIlB,SACDA,OAAOoH,mBAAmD,OAA9B/E,QAAQnH,kBAC7B8E,UAGTT,WAAaE,UAAUY,OAAO6G,SAAU,CAC1CG,eAAgB,CAAC,CAAEC,SAAUP,iBAAkBxI,QAAS4I,kBACxDI,cAAe,CAACR,kBAChBS,kBAAkB,IAGtBtB,UAAU3G,KAAKA,MACf2G,UAAUxL,KAAK,uBAAuBwJ,GAAG,SAAS,KAC9C3D,qBAAqB/F,KAAM8F,gBAGjC,MAAO2G,OACL3J,aAAaG,UAAUwJ,SAUlBQ,YAAc,CAACC,UAAWlN,QACnCkN,UAAUC,UAAUC,IAAI,UACxBC,KAAKrN,8CAiBIqN,KAAOrN,UAChBA,MAAO,mBAAEA,MACTN,YAAc,GACdE,SAAW,EACXD,aAAe,GAEVK,KAAKO,KAAK,aAAc,CACZ+M,SAASC,cAAcpN,mBAAUE,OAAOmN,aACrDpE,uBAAuBpJ,MACvBF,UAAY,0BAA4BE,KAAKO,KAAK,MAAQ,IAAMkN,KAAKC,SACrE1N,KAAKO,KAAK,aAAa,GAG3BqI,uBAAuB5I,KAAM4H,iEAYZ5H,UACbN,YAAY+E,OAAS,EAAG,IAIA,YAHR1E,gBAAgBC,MAGpBM,QAAgD,OAElDqN,MADOL,SAASC,cAAcpN,mBAAUE,OAAOmN,aAClCD,cAAcpN,mBAAUE,OAAOuN,aAC9B,KAAhBD,MAAMhH,MACNiC,uBAAuB5I,KAAMqI,2BAA4BsF,MAAMhH,MAAMsE,QAErErC,uBAAuB5I,KAAM4H,mCAGjClI,YAAY4E,SAAQ,CAACC,WAAYlD,aACzBwD,iBAAmBzD,yBAAyBpB,KAAMqB,OACtDyD,cAAc9E,KAAMuE,YAAY1C,MAAK,CAACkD,KAAMC,KACjCC,UAAUC,oBAAoBL,iBAAkBE,KAAMC,MAC9DhC,MAAMF,aAAaG,mBAI9BoK,KAAKrN"}